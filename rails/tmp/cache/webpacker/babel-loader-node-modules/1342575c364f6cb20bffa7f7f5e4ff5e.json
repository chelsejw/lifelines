{"ast":null,"code":"var _this = this,\n    _jsxFileName = \"/Users/chels/webdev/lifelines/app/javascript/packs/app/appeals/AppealsContainer.jsx\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread(); }\n\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _iterableToArray(iter) { if (typeof Symbol !== \"undefined\" && Symbol.iterator in Object(iter)) return Array.from(iter); }\n\nfunction _arrayWithoutHoles(arr) { if (Array.isArray(arr)) return _arrayLikeToArray(arr); }\n\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\n\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nfunction _iterableToArrayLimit(arr, i) { if (typeof Symbol === \"undefined\" || !(Symbol.iterator in Object(arr))) return; var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\nimport React, { useState, useEffect } from 'react';\nimport AppealResults from './components/AppealResults';\nimport FocusedAppeal from './components/FocusedAppeal';\nimport { connect } from 'react-redux';\nimport { fetchAllAppeals } from '../../app/appeals/actions';\nimport BarLoader from \"react-spinners/BarLoader\";\nimport { Route, useRouteMatch } from 'react-router-dom';\nimport { GoogleApiWrapper } from \"google-maps-react\";\nimport AppealOptions from './components/AppealOptions';\nimport axios from 'axios';\n\nvar AppealsContainer = function AppealsContainer(props) {\n  var _useState = useState(null),\n      _useState2 = _slicedToArray(_useState, 2),\n      userLoc = _useState2[0],\n      setUserLoc = _useState2[1];\n\n  var _useState3 = useState(\"Unavailable\"),\n      _useState4 = _slicedToArray(_useState3, 2),\n      locString = _useState4[0],\n      setLocString = _useState4[1];\n\n  var _useState5 = useState(false),\n      _useState6 = _slicedToArray(_useState5, 2),\n      loadingLoc = _useState6[0],\n      setLoadingLoc = _useState6[1];\n\n  var _useState7 = useState(\"\"),\n      _useState8 = _slicedToArray(_useState7, 2),\n      userPostal = _useState8[0],\n      setUserPostal = _useState8[1];\n\n  var _useState9 = useState([]),\n      _useState10 = _slicedToArray(_useState9, 2),\n      appeals = _useState10[0],\n      setAppeals = _useState10[1];\n\n  var _useState11 = useState(false),\n      _useState12 = _slicedToArray(_useState11, 2),\n      sortErrors = _useState12[0],\n      setSortErrors = _useState12[1];\n\n  var _useState13 = useState(\"newest\"),\n      _useState14 = _slicedToArray(_useState13, 2),\n      currentSort = _useState14[0],\n      setCurrentSort = _useState14[1];\n\n  var _useState15 = useState(\"\"),\n      _useState16 = _slicedToArray(_useState15, 2),\n      sortErrorMessage = _useState16[0],\n      setSortErrorMessage = _useState16[1];\n\n  var _useState17 = useState([]),\n      _useState18 = _slicedToArray(_useState17, 2),\n      originalData = _useState18[0],\n      setOriginalData = _useState18[1];\n\n  var _useState19 = useState({\n    includeClosed: false,\n    onlyVerified: false\n  }),\n      _useState20 = _slicedToArray(_useState19, 2),\n      filters = _useState20[0],\n      setFilters = _useState20[1];\n\n  useEffect(function () {\n    props.fetchInitialAppeals('/api/v1/appeals.json');\n    axios.get('/api/v1/appeals.json').then(function (res) {\n      setOriginalData(res.data);\n      var openAppeals = res.data.filter(function (appeals) {\n        return appeals.status !== \"closed\";\n      });\n      setAppeals(openAppeals);\n    })[\"catch\"](function (err) {\n      return console.log(err);\n    });\n  }, []);\n\n  var getMyLocation = function getMyLocation() {\n    if (userPostal !== \"\" || userPostal !== null) {\n      setUserPostal(\"\");\n    }\n\n    setLoadingLoc(true);\n\n    if (navigator.geolocation) {\n      navigator.geolocation.getCurrentPosition(function (position) {\n        var lat = position.coords.latitude;\n        var lng = position.coords.longitude;\n        var latlngObj = {\n          lat: lat,\n          lng: lng\n        };\n        setUserLoc(latlngObj);\n        getLocationString(latlngObj);\n        setLoadingLoc(false);\n      }, function (err) {\n        setUserLoc(\"Error getting your location.?\");\n      });\n    }\n  };\n\n  useEffect(function () {\n    setSortErrors(false);\n\n    var newAppeals = _toConsumableArray(originalData); //exclude closed\n\n\n    if (!filters.includeClosed) {\n      newAppeals = newAppeals.filter(function (appeal) {\n        return appeal.status !== \"closed\";\n      });\n    }\n\n    if (filters.onlyVerified) {\n      newAppeals = newAppeals.filter(function (appeal) {\n        return appeal.user.profile.verified;\n      });\n    }\n\n    if (currentSort == \"oldest\") {\n      newAppeals.sort(function (a, b) {\n        return new Date(a.created_at) > new Date(b.created_at) ? 1 : -1;\n      });\n    }\n\n    if (currentSort == \"newest\") {\n      newAppeals.sort(function (a, b) {\n        return new Date(a.created_at) > new Date(b.created_at) ? -1 : 1;\n      });\n    }\n\n    if (currentSort == \"closest\") {\n      if (!newAppeals[0].distance) {\n        setSortErrors(true);\n        return setSortErrorMessage(\"Sorry, please ensure you've clicked 'Get My Location'. If you have given a postal code, you can use 'Use My Postal Code' for more accurate results.\");\n      }\n\n      newAppeals.sort(function (a, b) {\n        var distA = parseFloat(a.distance);\n        var distB = parseFloat(b.distance);\n        console.log(\"distA \".concat(distA, \" > distB \").concat(distB, \" is \").concat(distA > distB));\n\n        if (isNaN(distA)) {\n          console.log(\"is not a number detected!!\");\n          console.log(a);\n        }\n\n        if (distA > distB) {\n          return 1;\n        } else if (distA < distB) {\n          return -1;\n        } else {\n          return 0;\n        }\n      });\n    }\n\n    if (currentSort == \"popular\") {\n      newAppeals.sort(function (a, b) {\n        return parseInt(a.lifelines.length) > parseInt(b.lifelines.length) ? -1 : 1;\n      });\n    }\n\n    if (currentSort == \"least_popular\") {\n      newAppeals.sort(function (a, b) {\n        return parseInt(a.lifelines.length) > parseInt(b.lifelines.length) ? 1 : -1;\n      });\n    }\n\n    return setAppeals(_toConsumableArray(newAppeals));\n  }, [currentSort, filters]);\n\n  var sort = function sort(option) {\n    setCurrentSort(option);\n  };\n\n  var filter = function filter(option, bool) {\n    setFilters(function (prevOptions) {\n      return _objectSpread(_objectSpread({}, prevOptions), {}, _defineProperty({}, option, bool));\n    });\n  };\n\n  var useMyAddress = function useMyAddress() {\n    if (userLoc !== \"\" || userLoc !== null) {\n      setUserLoc(\"\");\n    }\n\n    setUserPostal(\"Singapore+\".concat(props.auth.currentUser.profile.address));\n    setLocString(\"Singapore \".concat(props.auth.currentUser.profile.address));\n  };\n\n  var getLocationString = function getLocationString(latlngObj) {\n    var geocoder = new google.maps.Geocoder();\n    geocoder.geocode({\n      location: latlngObj\n    }, function (res, status) {\n      status !== \"OK\" ? console.log(\"GOT A GEOCODE????\", res) : console.log(\"Geocode error\", res);\n      setLocString(res[0].formatted_address);\n    });\n  };\n\n  var setDistance = function setDistance(id, distance) {\n    var newArr = _toConsumableArray(originalData);\n\n    var indexOfElement = newArr.findIndex(function (appeal) {\n      return appeal.id == id;\n    });\n    newArr[indexOfElement].distance = distance;\n    setOriginalData(_toConsumableArray(newArr));\n  };\n\n  useEffect(function () {\n    console.log(appeals);\n  }, [appeals]);\n\n  var _useRouteMatch = useRouteMatch(),\n      path = _useRouteMatch.path,\n      url = _useRouteMatch.url;\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"row\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 178,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"col-xl-4 col-md-6 col-6 p-0 shadow-sm\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 179,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(AppealOptions, {\n    filter: filter,\n    sortErrors: sortErrors,\n    sortErrorMessage: sortErrorMessage,\n    appeals: appeals,\n    sort: sort,\n    loadingLoc: loadingLoc,\n    auth: props.auth,\n    getMyLocation: getMyLocation,\n    locString: locString,\n    useMyAddress: useMyAddress,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 180,\n      columnNumber: 17\n    }\n  }), /*#__PURE__*/React.createElement(AppealResults, {\n    setDist: setDistance,\n    userLoc: locString,\n    geolocation: userLoc,\n    postal: userPostal,\n    data: appeals,\n    hasError: props.appeals.hasErrored,\n    isLoading: props.appeals.isLoading,\n    google: props.google,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 193,\n      columnNumber: 17\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"col-xl-8 col-md-6 col-6 py-5 sticky-div\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 205,\n      columnNumber: 15\n    }\n  }, props.appeals.focusedIsLoading && /*#__PURE__*/React.createElement(BarLoader, {\n    width: 100,\n    height: 4,\n    color: \"#123abc\",\n    loading: props.appeals.focusedIsLoading,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 207,\n      columnNumber: 19\n    }\n  }), props.appeals.focusedHasErrored && \"There was an error getting the appeal\", /*#__PURE__*/React.createElement(Route, {\n    path: \"\".concat(path),\n    exact: true,\n    render: function render() {\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"w-75 text-center get-started\",\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 219,\n          columnNumber: 23\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"center-element\",\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 220,\n          columnNumber: 25\n        }\n      }, /*#__PURE__*/React.createElement(\"h1\", {\n        className: \"text-danger fas fa-heartbeat\",\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 221,\n          columnNumber: 27\n        }\n      }), /*#__PURE__*/React.createElement(\"h1\", {\n        className: \"display-3 text-secondary\",\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 222,\n          columnNumber: 27\n        }\n      }, \"Click on an appeal to get more details!\")));\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 217,\n      columnNumber: 19\n    }\n  }), /*#__PURE__*/React.createElement(Route, {\n    path: \"\".concat(path, \"/:appealId\"),\n    component: FocusedAppeal,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 229,\n      columnNumber: 17\n    }\n  })));\n};\n\nvar mapStateToProps = function mapStateToProps(state) {\n  return {\n    appeals: state.appeals,\n    auth: state.auth\n  };\n};\n\nvar mapDispatchToProps = function mapDispatchToProps(dispatch) {\n  return {\n    fetchInitialAppeals: function fetchInitialAppeals(url) {\n      console.log(\"Fetch appeals ran\");\n      dispatch(fetchAllAppeals(url));\n    },\n    fetchOneAppeal: function (_fetchOneAppeal) {\n      function fetchOneAppeal(_x) {\n        return _fetchOneAppeal.apply(this, arguments);\n      }\n\n      fetchOneAppeal.toString = function () {\n        return _fetchOneAppeal.toString();\n      };\n\n      return fetchOneAppeal;\n    }(function (url) {\n      dispatch(fetchOneAppeal(url));\n    })\n  };\n};\n\nvar WrappedContainer = GoogleApiWrapper({\n  apiKey: process.env.MAPS_API_KEY\n})(AppealsContainer);\nexport default connect(mapStateToProps, mapDispatchToProps)(WrappedContainer);","map":{"version":3,"sources":["/Users/chels/webdev/lifelines/app/javascript/packs/app/appeals/AppealsContainer.jsx"],"names":["React","useState","useEffect","AppealResults","FocusedAppeal","connect","fetchAllAppeals","BarLoader","Route","useRouteMatch","GoogleApiWrapper","AppealOptions","axios","AppealsContainer","props","userLoc","setUserLoc","locString","setLocString","loadingLoc","setLoadingLoc","userPostal","setUserPostal","appeals","setAppeals","sortErrors","setSortErrors","currentSort","setCurrentSort","sortErrorMessage","setSortErrorMessage","originalData","setOriginalData","includeClosed","onlyVerified","filters","setFilters","fetchInitialAppeals","get","then","res","data","openAppeals","filter","status","err","console","log","getMyLocation","navigator","geolocation","getCurrentPosition","position","lat","coords","latitude","lng","longitude","latlngObj","getLocationString","newAppeals","appeal","user","profile","verified","sort","a","b","Date","created_at","distance","distA","parseFloat","distB","isNaN","parseInt","lifelines","length","option","bool","prevOptions","useMyAddress","auth","currentUser","address","geocoder","google","maps","Geocoder","geocode","location","formatted_address","setDistance","id","newArr","indexOfElement","findIndex","path","url","hasErrored","isLoading","focusedIsLoading","focusedHasErrored","mapStateToProps","state","mapDispatchToProps","dispatch","fetchOneAppeal","WrappedContainer","apiKey","process","env","MAPS_API_KEY"],"mappings":"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","sourcesContent":["import React, {useState, useEffect} from 'react'\nimport AppealResults from './components/AppealResults'\nimport FocusedAppeal from './components/FocusedAppeal'\nimport { connect } from 'react-redux';\nimport { fetchAllAppeals } from '../../app/appeals/actions'\nimport BarLoader from \"react-spinners/BarLoader\";\nimport { Route, useRouteMatch} from 'react-router-dom'\nimport { GoogleApiWrapper } from \"google-maps-react\";\nimport AppealOptions from './components/AppealOptions'\nimport axios from 'axios'\n\nconst AppealsContainer = (props) => {\n    const [userLoc, setUserLoc] = useState(null);\n    const [locString, setLocString] = useState(\"Unavailable\")\n    const [loadingLoc, setLoadingLoc] = useState(false)\n    const [userPostal, setUserPostal] = useState(\"\")\n    const [appeals, setAppeals] = useState([])\n    const [sortErrors, setSortErrors] = useState(false)\n    const [currentSort, setCurrentSort] = useState(\"newest\")\n    const [sortErrorMessage, setSortErrorMessage] = useState(\"\")\n    const [originalData, setOriginalData] = useState([])\n    const [filters, setFilters] = useState({\n      includeClosed: false,\n      onlyVerified: false\n    })\n\n  useEffect(()=> {\n    props.fetchInitialAppeals('/api/v1/appeals.json');\n    \n    axios.get('/api/v1/appeals.json').then(res => {\n      setOriginalData(res.data)\n\n      const openAppeals = res.data.filter(appeals => appeals.status!==\"closed\")\n      setAppeals(openAppeals)\n    }).catch(err => console.log(err))\n  }, [])\n\n  const getMyLocation = () => {\n        if (userPostal !== \"\" || userPostal !== null) {\n          setUserPostal(\"\");\n        }\n    setLoadingLoc(true)\n      if (navigator.geolocation) {\n          navigator.geolocation.getCurrentPosition(\n              (position) => {\n                  let lat = position.coords.latitude;\n                  let lng = position.coords.longitude;\n                  let latlngObj = {\n                      lat,\n                      lng\n                  };\n                  setUserLoc(latlngObj);\n                  getLocationString(latlngObj);\n                  setLoadingLoc(false)\n              },\n              (err) => {\n                  setUserLoc(\"Error getting your location.?\");\n              }\n          );\n      }\n  }\n\n  useEffect(()=> {\n        setSortErrors(false);\n\n    let newAppeals = [...originalData]\n\n    //exclude closed\n    if (!filters.includeClosed) {\n      newAppeals = newAppeals.filter(appeal => appeal.status!==\"closed\")\n    }\n\n    if (filters.onlyVerified) {\n      newAppeals = newAppeals.filter(appeal => appeal.user.profile.verified)\n    }\n\n\n    if (currentSort == \"oldest\") {\n      newAppeals.sort((a, b) =>\n        new Date(a.created_at) > new Date(b.created_at) ? 1 : -1\n      );\n    }\n    if (currentSort == \"newest\") {\n      newAppeals.sort((a, b) =>\n        new Date(a.created_at) > new Date(b.created_at) ? -1 : 1\n      );\n    }\n    if (currentSort == \"closest\") {\n      if (!newAppeals[0].distance) {\n        setSortErrors(true);\n        return setSortErrorMessage(\n          \"Sorry, please ensure you've clicked 'Get My Location'. If you have given a postal code, you can use 'Use My Postal Code' for more accurate results.\"\n        );\n      }\n      newAppeals.sort((a, b) => {\n        let distA = parseFloat(a.distance)\n        let distB = parseFloat(b.distance)\n        console.log(`distA ${distA} > distB ${distB} is ${distA > distB}`)\n\n        if (isNaN(distA)) {\n          console.log(`is not a number detected!!`)\n          console.log(a)\n        }\n\n        if (distA > distB) {\n          return 1\n        } else if (distA < distB) {\n          return -1\n        } else {\n          return 0\n        }\n\n      })\n    }\n    if (currentSort == \"popular\") {\n      newAppeals.sort((a, b) =>\n        parseInt(a.lifelines.length) > parseInt(b.lifelines.length) ? -1 : 1\n      );\n    }\n    if (currentSort == \"least_popular\") {\n      newAppeals.sort((a, b) =>\n        parseInt(a.lifelines.length) > parseInt(b.lifelines.length) ? 1 : -1\n      );\n    }\n\n    return setAppeals([...newAppeals]);\n  }, [currentSort, filters])\n\n\n  const sort = (option)=> {\n    setCurrentSort(option)\n  }\n\n  const filter = (option, bool) => {\n\n    setFilters( prevOptions => {\n      return {\n        ...prevOptions,\n        [option]: bool\n      }\n    })\n\n  }\n\n  const useMyAddress = ()=> {\n    if (userLoc!==\"\" || userLoc!==null ) {\n      setUserLoc(\"\")\n    }\n    setUserPostal(`Singapore+${props.auth.currentUser.profile.address}`);\n    setLocString(`Singapore ${props.auth.currentUser.profile.address}`);\n  }\n\n  const getLocationString = (latlngObj)=>{\n      let geocoder = new google.maps.Geocoder();\n\n      geocoder.geocode({\n          location: latlngObj\n      }, (res, status) => {\n          status !== \"OK\" ? console.log(`GOT A GEOCODE????`, res) : console.log(`Geocode error`, res);\n          setLocString(res[0].formatted_address)\n      });\n  }\n\n  const setDistance = (id, distance) => {\n    const newArr = [...originalData]\n    let indexOfElement = newArr.findIndex(appeal => appeal.id==id)\n    newArr[indexOfElement].distance = distance\n    setOriginalData([...newArr])\n  }\n  \n  useEffect(()=> {\n    console.log(appeals)\n  }, [appeals])\n      \n      let {path, url} = useRouteMatch();\n\n        return (\n            <div className=\"row\">\n              <div className=\"col-xl-4 col-md-6 col-6 p-0 shadow-sm\">\n                <AppealOptions\n                  filter={filter}\n                  sortErrors={sortErrors}\n                  sortErrorMessage={sortErrorMessage}\n                  appeals={appeals}\n                  sort={sort}\n                  loadingLoc={loadingLoc}\n                  auth={props.auth}\n                  getMyLocation={getMyLocation}\n                  locString={locString}\n                  useMyAddress={useMyAddress}\n                />\n\n                <AppealResults\n                  setDist={setDistance}\n                  userLoc={locString}\n                  geolocation={userLoc}\n                  postal={userPostal}\n                  data={appeals}\n                  hasError={props.appeals.hasErrored}\n                  isLoading={props.appeals.isLoading}\n                  google={props.google}\n                />\n              </div>\n\n              <div className=\"col-xl-8 col-md-6 col-6 py-5 sticky-div\">\n                {props.appeals.focusedIsLoading && (\n                  <BarLoader\n                    width={100}\n                    height={4}\n                    color={\"#123abc\"}\n                    loading={props.appeals.focusedIsLoading}\n                  />\n                )}\n                {props.appeals.focusedHasErrored &&\n                  \"There was an error getting the appeal\"}\n\n                  <Route path={`${path}`} exact render={()=> {\n                    return (\n                      <div className=\"w-75 text-center get-started\">\n                        <div className=\"center-element\">\n                          <h1 className=\"text-danger fas fa-heartbeat\"></h1>\n                          <h1 className=\"display-3 text-secondary\">\n                            Click on an appeal to get more details!\n                          </h1>\n                        </div>\n                      </div>\n                    );\n                  }}/>\n                <Route path={`${path}/:appealId`} component={FocusedAppeal} />\n              </div>\n            </div>\n        );\n      }\n\n\nconst mapStateToProps = (state) => {\n    return {\n        appeals: state.appeals,\n        auth: state.auth\n    };\n  };\n  const mapDispatchToProps = (dispatch) => {\n    return {\n        fetchInitialAppeals: (url) => {\n          console.log(`Fetch appeals ran`)\n          dispatch(fetchAllAppeals(url))\n        },\n        fetchOneAppeal: url => {\n          dispatch(fetchOneAppeal(url))\n        },\n    };\n  };\n  \n  const WrappedContainer = GoogleApiWrapper({\n    apiKey: process.env.MAPS_API_KEY,\n  })(AppealsContainer);\n  export default connect(mapStateToProps, mapDispatchToProps)(WrappedContainer);"]},"metadata":{},"sourceType":"module"}